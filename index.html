<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conecta FCFM - Transporte Seguro</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content" role="banner">
            <button class="menu-toggle" id="menuToggle" aria-label="Abrir men&uacute;">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-brand" aria-live="polite">
                <h1 class="header-title">Conecta FCFM</h1>
            </div>
            <button class="panic-btn" id="panicBtn" aria-label="Bot&oacute;n de p&aacute;nico">
                <i class="fas fa-exclamation-triangle"></i>
            </button>
        </div>
    </header>

    <!-- Side Navigation -->
    <nav class="sidenav" id="sideNav">
        <div class="sidenav-header">
            <h2>Conecta FCFM</h2>
            <button class="close-btn" id="closeNav" aria-label="Cerrar men√∫">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="nav-menu">
            <li><a href="/registro" data-section="registro"><i class="fas fa-id-card"></i> Registro</a></li>
            <li><a href="/inicio" data-section="home"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="/transporte-publico" data-section="transporte-publico"><i class="fas fa-subway"></i> Transporte P√∫blico</a></li>
            <li><a href="/vehiculo" data-section="vehiculo"><i class="fas fa-car"></i> Veh√≠culo</a></li>
            <li><a href="/mis-viajes" data-section="mis-viajes"><i class="fas fa-route"></i> Mis Viajes</a></li>
            <li><a href="/rutas" data-section="rutas"><i class="fas fa-shield-alt"></i> Rutas</a></li>
            <li><a href="/perfil" data-section="perfil"><i class="fas fa-user"></i> Perfil</a></li>
            <li><a href="/configuracion" data-section="configuracion"><i class="fas fa-cog"></i> Configuraci√≥n</a></li>
        </ul>
    </nav>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Registro Section -->
        <section class="section" id="registro">
            <div class="container">
                <div class="section-header">
                    <h2>Registro exclusivo FCFM</h2>
                    <p>Verificamos que s√≥lo miembros de la facultad accedan a Conecta FCFM antes de habilitar sus viajes.</p>
                </div>
                <div class="registration-grid">
                    <div class="card registration-info">
                        <div class="card__body">
                            <h3>Requisitos clave</h3>
                            <p class="registration-subtitle">S√≥lo aceptamos correos institucionales:</p>
                            <ul class="registration-domains">
                                <li>@ug.uchile.cl</li>
                                <li>@ing.uchile.cl</li>
                                <li>@uchile.cl</li>
                                <li>@idiem.cl</li>
                            </ul>
                            <div class="registration-steps">
                                <div class="step-item">
                                    <span class="step-index">1</span>
                                    <p>Completa el formulario con tu informaci√≥n b√°sica.</p>
                                </div>
                                <div class="step-item">
                                    <span class="step-index">2</span>
                                    <p>Recibe un c√≥digo o enlace seguro en tu bandeja institucional.</p>
                                </div>
                                <div class="step-item">
                                    <span class="step-index">3</span>
                                    <p>Confirma tu cuenta y configura contactos de emergencia.</p>
                                </div>
                            </div>
                            <p class="registration-note">
                                Este flujo se activar√° al finalizar el MVP para permitir las pruebas internas sin fricciones.
                            </p>
                        </div>
                    </div>
                    <div class="card registration-form">
                        <div class="card__body">
                            <h3>√önete a la red</h3>
                            <form id="registrationForm" autocomplete="off">
                                <div class="form-group">
                                    <label class="form-label" for="registrationMethod">M√©todo de verificaci√≥n</label>
                                    <select id="registrationMethod" class="form-control" name="method" required>
                                        <option value="codigo">C√≥digo enviado por correo</option>
                                        <option value="enlace">Enlace seguro (v√°lido 15 min)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="registrationEmail">Correo institucional</label>
                                    <input type="email" id="registrationEmail" class="form-control" name="email" placeholder="tu.nombre@ing.uchile.cl" required>
                                    <small class="form-hint">Verificaremos autom√°ticamente el dominio permitido.</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="registrationUser">Nombre para mostrar</label>
                                    <input type="text" id="registrationUser" class="form-control" name="displayName" placeholder="Ej: Camila Soto" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="registrationPassword">Contrase√±a segura</label>
                                    <input type="password" id="registrationPassword" class="form-control" name="password" minlength="8" placeholder="M√≠nimo 8 caracteres" required>
                                </div>
                                <div class="form-group" id="registrationCodeGroup">

                                    <label class="form-label" for="registrationCode">CÔøΩÔøΩdigo de confirmaciÔøΩÔøΩn</label>

                                    <input type="text" id="registrationCode" class="form-control" name="verificationCode" placeholder="Ingresa el cÔøΩÔøΩdigo recibido" maxlength="6">

                                    <small class="form-hint">Si elegiste enlace seguro, este campo se completa autom«≠ticamente.</small>

                                </div>

                                <div class="form-actions">

                                    <button type="submit" class="btn btn--primary btn--full-width">Pre-registrarme</button>

                                </div>

                                <small class="form-status" id="registrationStatus"></small>
<p class="form-disclaimer">
                                    Al confirmar, aceptar√°s las pol√≠ticas de seguridad y convivencia de Conecta FCFM.
                                </p>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="status-grid config-status-grid">
                    <div class="sync-indicator card" id="appSyncIndicator" role="status" aria-live="polite">
                        <div class="card__body">
                            <div class="sync-indicator__status">
                                <span class="sync-dot" aria-hidden="true"></span>
                                <div class="sync-copy">
                                    <p id="syncStatusLabel">Sincronizando con el servidor...</p>
                                    <small id="syncStatusHelper">Preparando los datos iniciales.</small>
                                </div>
                            </div>
                            <button type="button" class="btn btn--outline btn--sm" id="retrySyncBtn">
                                <i class="fas fa-rotate-right"></i>
                                Reintentar
                            </button>
                        </div>
                    </div>

                </div>

                </div>
            </div>
        </section>
        <!-- Home Section -->
        <section class="section active" id="home">
            <div class="container">
                <div class="welcome-card card">
                    <div class="card__body">
                        <h2>&iexcl;Bienvenido a Conecta FCFM!</h2>
                        <p>Tu plataforma de transporte seguro y colaborativo para la comunidad FCFM</p>
                        <div class="user-status">
                            <div class="status-item">
                                <i class="fas fa-users"></i>
                                <span id="activeMembersCount">-- miembros activos</span>
                            </div>
                            <div class="status-item">
                                <i class="fas fa-route"></i>
                                <span id="tripsTodayCount">-- viajes hoy</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>Acceso R√°pido</h3>
                    <div class="action-grid">
                        <button class="action-btn" data-section="transporte-publico">
                            <i class="fas fa-subway"></i>
                            <span>Transporte P√∫blico</span>
                        </button>
                        <button class="action-btn" data-section="vehiculo">
                            <i class="fas fa-car"></i>
                            <span>Veh√≠culo</span>
                        </button>
                        <button class="action-btn" data-section="mis-viajes">
                            <i class="fas fa-route"></i>
                            <span>Mis Viajes</span>
                        </button>
                        <button class="action-btn" data-section="rutas">
                            <i class="fas fa-shield-alt"></i>
                            <span>Rutas</span>
                        </button>
                    </div>
                </div>

                <div class="recent-activity card">
                    <div class="card__body">
                        <h3>Actividad Reciente</h3>
                        <div id="recentActivityList" class="activity-list">
                            <p class="activity-empty">Sin actividad reciente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Transporte P√∫blico Section -->
        <section class="section" id="transporte-publico">
            <div class="container">
                <div class="section-header">
                    <h2>Transporte P√∫blico</h2>
                    <p>Forma grupos para viajar de manera segura en Metro, Micro o a pie</p>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="viajes-publicos">Ver Viajes</button>
                    <button class="tab-btn" data-tab="crear-viaje-publico">Crear Viaje</button>
                </div>

                <div class="tab-content active" id="viajes-publicos">
                    <div class="filters">
                        <select class="form-control" id="filterMode">
                            <option value="">Todos los medios</option>
                            <option value="Metro">Metro</option>
                            <option value="Micro">Micro</option>
                            <option value="A pie">A pie</option>
                        </select>
                    </div>
                    <div class="trip-meta-bar">
                        <p id="publicTripsSummary" class="trip-summary" aria-live="polite">Sincronizando viajes...</p>
                        <button type="button" class="btn btn--outline btn--sm" id="refreshPublicTripsBtn">
                            <i class="fas fa-rotate-right"></i> Actualizar
                        </button>
                    </div>

                    <div class="trips-list" id="publicTrips">
                        <div class="trip-card card">
                            <div class="card__body">
                                <div class="trip-header">
                                    <span class="trip-mode metro">Metro L4</span>
                                    <span class="trip-time">14:30</span>
                                </div>
                                <div class="trip-route">
                                    <p><strong>Metro U. de Chile ‚Üí FCFM Beauchef</strong></p>
                                    <p class="trip-creator">Creado por Mar√≠a Gonz√°lez ‚≠ê 4.8</p>
                                </div>
                                <div class="trip-info">
                                    <button class="btn btn--primary btn--sm">Unirse</button>
                                </div>
                            </div>
                        </div>

                        <div class="trip-card card">
                            <div class="card__body">
                                <div class="trip-header">
                                    <span class="trip-mode micro">Micro B16</span>
                                    <span class="trip-time">18:15</span>
                                </div>
                                <div class="trip-route">
                                    <p><strong>FCFM ‚Üí Metro Baquedano</strong></p>
                                    <p class="trip-creator">Creado por Carlos Rodr√≠guez ‚≠ê 4.9</p>
                                </div>
                                <div class="trip-info">
                                    <button class="btn btn--primary btn--sm">Unirse</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="crear-viaje-publico">
                    <form class="trip-form" id="publicTripForm">
                        <div class="form-group">
                            <label class="form-label">Medio de Transporte</label>
                            <select class="form-control" name="mode" id="publicTransportMode" required>
                                <option value="">Seleccionar</option>
                                <option value="Metro">Metro</option>
                                <option value="Micro">Micro</option>
                                <option value="A pie">A pie</option>
                            </select>
                        </div>

                        <div class="form-group hidden" id="metroLineGroup">
                            <label class="form-label">L√≠nea de Metro</label>
                            <select class="form-control" name="metroLine" id="metroLineSelect">
                                <option value="">Seleccionar l√≠nea</option>
                            </select>
                        </div>

                        <div class="form-group hidden" id="microLineGroup">
                            <label class="form-label">Micro</label>
                            <input type="text" class="form-control" name="microLine" placeholder="Ej: B16">
                        </div>

                        <div class="form-group">
                            <label class="form-label" id="originFieldLabel">Origen</label>
                            <input type="text" class="form-control" name="origin" placeholder="Punto de salida" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Destino</label>
                            <input type="text" class="form-control" name="destination" placeholder="Punto de llegada" required>
                        </div>

                        <div class="swap-actions">
                            <button type="button" class="btn btn--outline btn--sm swap-route-btn" data-target="publicTripForm">
                                <i class="fas fa-exchange-alt"></i>
                                Intercambiar origen y destino
                            </button>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Lugar de Encuentro</label>
                            <input type="text" class="form-control" name="meetingPoint" placeholder="Ej: Entrada principal FCFM" required>
                        </div>

                        <div class="form-group hidden" id="directionGroup">
                            <label class="form-label">Direcci√≥n</label>
                            <input type="text" class="form-control" name="routeDirection" placeholder="Ej: San Pablo ‚Üî Los Dominicos">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Descripci√≥n del viaje</label>
                            <textarea class="form-control" name="description" rows="3" placeholder="Comparte detalles adicionales del viaje"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control" name="date" data-default-date="today" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Hora</label>
                            <input type="time" class="form-control" name="time" required>
                        </div>

                        <button type="submit" class="btn btn--primary btn--full-width">Publicar Viaje</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Veh√≠culo Section -->
        <section class="section" id="vehiculo">
            <div class="container">
                <div class="section-header">
                    <h2>Veh√≠culo</h2>
                    <p>Comparte viajes en auto o moto de manera segura</p>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="viajes-vehiculo">Ver Viajes</button>
                    <button class="tab-btn" data-tab="publicar-vehiculo">Publicar Viaje</button>
                </div>

                <div class="tab-content active" id="viajes-vehiculo">
                    <div class="filters">
                        <label class="form-label" for="vehicleFilter">Tipo de veh√≠culo</label>
                        <select class="form-control" id="vehicleFilter">
                            <option value="todos">Todos</option>
                            <option value="Autom√≥vil">Autom√≥vil</option>
                            <option value="Motocicleta">Motocicleta</option>
                        </select>
                    </div>
                    <div class="trip-meta-bar">
                        <p id="vehicleTripsSummary" class="trip-summary" aria-live="polite">Sincronizando viajes...</p>
                        <button type="button" class="btn btn--outline btn--sm" id="refreshVehicleTripsBtn">
                            <i class="fas fa-rotate-right"></i> Actualizar
                        </button>
                    </div>
                    <div class="vehicle-trips" id="vehicleTrips">
                        <div class="vehicle-trip-card card">
                            <div class="card__body">
                                <div class="driver-info">
                                    <div class="driver-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="driver-details">
                                        <h4>Ana Mart√≠nez</h4>
                                        <div class="rating">
                                            <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                            <span>4.7 (23 viajes)</span>
                                        </div>
                                        <span class="vehicle-type">üöó Autom√≥vil</span>
                                    </div>
                                </div>
                                <div class="trip-details">
                                    <div class="route">
                                        <p><strong>Providencia ‚Üí FCFM</strong></p>
                                        <p class="route-desc">Av. Providencia - Av. Vicu√±a Mackenna - Av. Beauchef</p>
                                    </div>
                                    <div class="trip-meta">
                                        <span class="time">08:00</span>
                                        <span class="seats">2 asientos</span>
                                        <span class="donation">$1,500 donaci√≥n</span>
                                    </div>
                                </div>
                                <button class="btn btn--primary btn--full-width">Solicitar Viaje</button>
                            </div>
                        </div>

                        <div class="vehicle-trip-card card">
                            <div class="card__body">
                                <div class="driver-info">
                                    <div class="driver-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="driver-details">
                                        <h4>Carlos Rodr√≠guez</h4>
                                        <div class="rating">
                                            <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                            <span>4.9 (67 viajes)</span>
                                        </div>
                                        <span class="vehicle-type">üöó Autom√≥vil</span>
                                    </div>
                                </div>
                                <div class="trip-details">
                                    <div class="route">
                                        <p><strong>FCFM ‚Üí Maip√∫</strong></p>
                                        <p class="route-desc">Av. Beauchef - Alameda - Av. Pajaritos</p>
                                    </div>
                                    <div class="trip-meta">
                                        <span class="time">16:45</span>
                                        <span class="seats">3 asientos</span>
                                        <span class="donation">$2,000 donaci√≥n</span>
                                    </div>
                                </div>
                                <button class="btn btn--primary btn--full-width">Solicitar Viaje</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="publicar-vehiculo">
                    <form class="trip-form" id="vehicleTripForm">
                        <div class="form-group">
                            <label class="form-label">Tipo de Veh√≠culo</label>
                            <select class="form-control" name="vehicleType" required>
                                <option value="">Seleccionar</option>
                                <option value="Autom√≥vil">Autom√≥vil</option>
                                <option value="Motocicleta">Motocicleta</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Origen</label>
                            <input type="text" class="form-control" name="origin" placeholder="Punto de salida" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Destino</label>
                            <input type="text" class="form-control" name="destination" placeholder="Punto de llegada" required>
                        </div>

                        <div class="swap-actions">
                            <button type="button" class="btn btn--outline btn--sm swap-route-btn" data-target="vehicleTripForm">
                                <i class="fas fa-exchange-alt"></i>
                                Intercambiar origen y destino
                            </button>
                        </div>

                        <div class="map-tools">
                            <button type="button" class="btn btn--secondary btn--sm" id="calculateVehicleRoute">
                                <i class="fas fa-map"></i>
                                Calcular ruta
                            </button>
                        </div>

                        <div class="map-container">
                            <div id="vehicleFormMap" class="leaflet-map"></div>
                            <p class="map-placeholder">Ingresa el origen y destino, luego presiona "Calcular ruta".</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control" name="date" data-default-date="today" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Hora de Salida</label>
                            <input type="time" class="form-control" name="time" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Asientos Disponibles</label>
                            <input type="number" class="form-control" name="seats" min="1" max="4" value="2" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Donaci√≥n Sugerida (CLP)</label>
                            <input type="number" class="form-control" name="donation" placeholder="1500" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Descripci√≥n de la Ruta</label>
                            <textarea class="form-control" name="route" rows="3" placeholder="Describe la ruta que tomar√°s"></textarea>
                        </div>


                        <button type="submit" class="btn btn--primary btn--full-width">Publicar Viaje</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Mis Viajes Section -->
        <section class="section" id="mis-viajes">
            <div class="container">
                <div class="section-header">
                    <h2>Mis Viajes</h2>
                    <p>Gestiona tus viajes activos y completados</p>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="viajes-activos">Viajes Activos</button>
                    <button class="tab-btn" data-tab="viajes-terminados">Viajes Terminados</button>
                </div>

                
                <div class="tab-content active" id="viajes-activos">
                    <div class="my-trips" id="activeTripsList">
                        <p class="trip-empty">A√∫n no te has unido a viajes.</p>
                    </div>
                </div>

                <div class="tab-content" id="viajes-terminados">
                    <div class="completed-trips" id="completedTripsList">
                        <p class="trip-empty">A√∫n no tienes viajes terminados.</p>
                    </div>
                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Rutas Section -->
        <section class="section" id="rutas">
            <div class="container">
                <div class="section-header">
                    <h2>Rutas</h2>
                    <p>Reporta rutas seguras o incidentes y mant√©n a la comunidad informada</p>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="reportes-rutas">Ver Reportes</button>
                    <button class="tab-btn" data-tab="crear-reporte">Crear Reporte</button>
                </div>

                <div class="tab-content active" id="reportes-rutas">
                    <div class="filters filters--inline">
                        <div class="filter-group">
                            <label class="form-label" for="reportTypeFilter">Tipo</label>
                            <select class="form-control" id="reportTypeFilter">
                                <option value="todos">Todos</option>
                                <option value="unsafe_route">Ruta insegura</option>
                                <option value="incident">Incidente</option>
                                <option value="safe_route">Ruta segura</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="form-label" for="reportSeverityFilter">Riesgo</label>
                            <select class="form-control" id="reportSeverityFilter">
                                <option value="todos">Todos</option>
                                <option value="low">Bajo</option>
                                <option value="medium">Medio</option>
                                <option value="high">Alto</option>
                            </select>
                        </div>
                    </div>
                    <div class="trip-meta-bar">
                        <p id="safetyReportsSummary" class="trip-summary" aria-live="polite">Sincronizando reportes...</p>
                        <button type="button" class="btn btn--outline btn--sm" id="refreshReportsBtn">
                            <i class="fas fa-rotate-right"></i> Actualizar
                        </button>
                    </div>
                    <div class="reports-insights" id="safetyReportsInsights">
                        <p class="insight-empty">Analizando reportes recientes...</p>
                    </div>
                    <div class="safety-reports"></div>
                </div>

                <div class="tab-content" id="crear-reporte">
                    <form class="report-form" id="safetyReportForm">
                        <div class="form-group">
                            <label class="form-label">Tipo de Reporte</label>
                            <select class="form-control" name="type" required>
                                <option value="">Seleccionar</option>
                                <option value="unsafe_route">Ruta Insegura</option>
                                <option value="incident">Incidente</option>
                                <option value="safe_route">Ruta Segura</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ubicaci√≥n</label>
                            <input type="text" class="form-control" name="location" placeholder="Describe la ubicaci√≥n exacta" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Hora del Incidente</label>
                            <input type="time" class="form-control" name="time" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Descripci√≥n</label>
                            <textarea class="form-control" name="description" rows="4" placeholder="Describe lo que observaste o experimentaste" required></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Nivel de Riesgo</label>
                            <select class="form-control" name="severity" required>
                                <option value="">Seleccionar</option>
                                <option value="low">Bajo</option>
                                <option value="medium">Medio</option>
                                <option value="high">Alto</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="anonymous"> Reportar an√≥nimamente
                            </label>
                        </div>

                        <button type="submit" class="btn btn--primary btn--full-width">Enviar Reporte</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Perfil Section -->
        <section class="section" id="perfil">
            <div class="container">
                <div class="section-header">
                    <h2>Perfil</h2>
                    <p>Completa tu informaci√≥n para verificar tu cuenta y compartir viajes con m√°s confianza</p>
                </div>

                <div class="profile-layout">
                    <div class="card profile-summary">
                        <div class="card__body">
                            <div class="profile-avatar large">
                                <img src="https://ui-avatars.com/api/?name=Usuario+Demo&background=2563eb&color=fff" alt="Avatar">
                                <button class="btn btn--outline btn--sm" id="changeAvatarBtn">
                                    <i class="fas fa-camera"></i> Cambiar foto
                                </button>
                                <input type="file" id="profileAvatarInput" accept="image/*" hidden>
                            </div>
                            <div class="profile-summary-info">
                                <h3 id="profileName">Usuario Demo</h3>
                                <p id="profileEmail">estudiante@fcfm.uchile.cl</p>
                                <div class="profile-summary-stats">
                                    <div class="stat">
                                        <span class="stat-number" id="profileTripsCompleted">12</span>
                                        <span class="stat-label">Viajes completados</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number" id="profileTripsCreated">5</span>
                                        <span class="stat-label">Viajes creados</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-number" id="profileRating">4.8</span>
                                        <span class="stat-label">Calificaci√≥n</span>
                                    </div>
                                </div>
                                <div class="verification-status" id="verificationStatus">
                                    <i class="fas fa-circle-check"></i> Perfil verificado
                                </div>
                                <div class="profile-health">
                                    <div class="profile-progress-track">
                                        <div class="profile-progress-fill" id="profileProgressBar">
                                            <span id="profileProgressValue">0%</span>
                                        </div>
                                    </div>
                                    <small id="profileProgressLabel" class="profile-progress-label">Completa tu perfil para mejorar la confianza.</small>
                                    <ul id="profileMissingFields" class="profile-missing-list">
                                        <li class="all-good">Perfil completo</li>
                                    </ul>
                                    <small class="profile-updated" id="profileUpdatedAt">Actualizado hace instantes</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-details card">
                        <div class="card__body">
                            <h4>Informaci√≥n personal</h4>
                            <form class="profile-form" id="profileForm">
                                <div class="form-group">
                                    <label class="form-label" for="profilePhone">Tel√©fono</label>
                                    <input type="tel" class="form-control" id="profilePhone" placeholder="+56 9 XXXX XXXX">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileEmergencyContacts">Contactos de emergencia</label>
                                    <textarea class="form-control" id="profileEmergencyContacts" rows="2" placeholder="Ingresa nombres y n√∫meros de contacto"></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileDescription">Descripci√≥n</label>
                                    <textarea class="form-control" id="profileDescription" rows="3" placeholder="Cu√©ntale a otros tu experiencia viajando"></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileBankDetails">Datos bancarios (para donaciones)</label>
                                    <textarea class="form-control" id="profileBankDetails" rows="2" placeholder="Banco, tipo de cuenta, n√∫mero"></textarea>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn btn--primary">Guardar cambios</button>
                                </div>
                                <small id="profileFormStatus" class="form-status"></small>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat Section -->
        <section class="section" id="chat">
            <div class="container">
                <div class="section-header chat-header">
                    <button class="btn btn--outline btn--sm" id="chatBackBtn">
                        <i class="fas fa-arrow-left"></i> Volver a mis viajes
                    </button>
                    <div>
                        <h2 id="chatTripTitle">Chat del viaje</h2>
                        <p id="chatTripSubtitle" class="chat-subtitle">Selecciona un viaje activo para chatear.</p>
                    </div>
                </div>
                <div class="chat-layout">
                    <div class="chat-panel card">
                        <div class="card__body">
                            <div class="chat-toolbar">
                                <div class="chat-status is-idle" id="chatStatusPill" role="status" aria-live="polite">
                                    <span id="chatStatusText">Selecciona un viaje para cargar el chat</span>
                                    <small id="chatStatusTime">√öltima sincronizaci√≥n: nunca</small>
                                </div>
                                <div class="chat-toolbar-actions">
                                    <button type="button" class="btn btn--outline btn--sm" id="chatRefreshBtn" disabled>
                                        <i class="fas fa-rotate-right"></i> Actualizar
                                    </button>
                                </div>
                            </div>
                            <div class="message-list" id="chatMessageList">
                                <p class="activity-empty">Selecciona un viaje activo para iniciar la conversaci√≥n.</p>
                            </div>
                            <form id="chatMessageForm" class="chat-input">
                                <input type="text" id="chatMessageInput" class="form-control" placeholder="Escribe un mensaje..." autocomplete="off">
                                <button type="submit" class="btn btn--primary">Enviar</button>
                            </form>
                        </div>
                    </div>
                    <div class="chat-sidebar card">
                        <div class="card__body">
                            <h4>Participantes</h4>
                            <div id="chatParticipantsList" class="participants-list">
                                <p class="activity-empty">A√∫n no hay participantes.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Configuraci√≥n Section -->
        <section class="section" id="configuracion">
            <div class="container">
                <div class="section-header">
                    <h2>Configuraci√≥n</h2>
                </div>

                <div class="settings-sections">
                    <div class="card">
                        <div class="card__body">
                            <h4>Apariencia e idioma</h4>
                            <div class="setting-item">
                                <label class="setting-label" for="darkModeToggle">
                                    <div>
                                        <span>Modo oscuro</span>
                                        <small class="setting-helper">Reduce el brillo para viajes nocturnos.</small>
                                    </div>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="darkModeToggle">
                                        <span class="slider"></span>
                                    </div>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label" for="languageToggle">
                                    <div>
                                        <span>Interfaz en ingl√©s</span>
                                        <small class="setting-helper" id="languageStatus">Mostrando contenido en espa√±ol.</small>
                                    </div>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="languageToggle">
                                        <span class="slider"></span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h4>Bot√≥n de p√°nico y seguridad</h4>
                            <div class="setting-item">
                                <label class="setting-label" for="panicSoundToggle">
                                    <div>
                                        <span>Alerta sonora</span>
                                        <small class="setting-helper">Activa un tono cuando inicies la cuenta regresiva.</small>
                                    </div>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="panicSoundToggle">
                                        <span class="slider"></span>
                                    </div>
                                </label>
                            </div>
                            <p class="setting-helper">Selecciona qui√©n recibe la alerta:</p>
                            <div class="panic-routing" role="group" aria-label="Destinatarios del bot√≥n de p√°nico">
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="panicCarabinerosToggle">
                                    <span>Carabineros</span>
                                </label>
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="panicMunicipalToggle">
                                    <span>Guardia municipal</span>
                                </label>
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="panicCivilToggle">
                                    <span>Guardia civil</span>
                                </label>
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="panicContactsToggle">
                                    <span>Contactos personales</span>
                                </label>
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="panicCommunityToggle">
                                    <span>Usuarios Conecta</span>
                                </label>
                            </div>
                            <p class="setting-helper" id="panicRecipientsSummary">Selecciona al menos un destinatario para la alerta.</p>
                            <div class="setting-item stack">
                                <div>
                                    <span>Contacto principal</span>
                                    <small class="setting-helper" id="panicContactInfo">Sincroniza tu tel√©fono desde Perfil.</small>
                                </div>
                                <button type="button" class="btn btn--outline btn--sm" id="editEmergencyProfileBtn">
                                    <i class="fas fa-user-edit"></i> Editar en Perfil
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h4>Ayuda y Soporte</h4>
                            <div class="help-links">
                                <a href="#" class="help-link">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Preguntas Frecuentes</span>
                                </a>
                                <a href="#" class="help-link">
                                    <i class="fas fa-envelope"></i>
                                    <span>Contactar Soporte</span>
                                </a>
                                <a href="#" class="help-link">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Pol√≠ticas de Seguridad</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <nav class="mobile-nav" id="mobileNav" aria-label="Navegaci&oacute;n r&aacute;pida">
        <button class="mobile-nav__btn active" data-section="home" aria-label="Ir a Inicio">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </button>
        <button class="mobile-nav__btn" data-section="transporte-publico" aria-label="Transporte p&uacute;blico">
            <i class="fas fa-subway"></i>
            <span>TP&uacute;blico</span>
        </button>
        <button class="mobile-nav__btn" data-section="vehiculo" aria-label="Viajes en veh&iacute;culo">
            <i class="fas fa-car"></i>
            <span>Veh&iacute;culo</span>
        </button>
        <button class="mobile-nav__btn" data-section="mis-viajes" aria-label="Mis viajes">
            <i class="fas fa-route"></i>
            <span>Mis viajes</span>
        </button>
        <button class="mobile-nav__btn" data-section="rutas" aria-label="Reportes de rutas">
            <i class="fas fa-shield-alt"></i>
            <span>Rutas</span>
        </button>
    </nav>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content container">
            <div class="footer-brand">
                <h3>Conecta FCFM</h3>
                <p>Red de movilidad y seguridad creada por y para la comunidad de la Facultad de Ciencias F√≠sicas y Matem√°ticas.</p>
            </div>
            <div class="footer-links">
                <a href="https://www.ing.uchile.cl" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-globe"></i> Portal FCFM
                </a>
                <a href="mailto:seguridad@conecta.cl">
                    <i class="fas fa-envelope"></i> seguridad@conecta.cl
                </a>
                <div class="footer-social">
                    <a href="#" aria-label="Instagram Conecta"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn Conecta"><i class="fab fa-linkedin"></i></a>
                    <a href="#" aria-label="Twitter Conecta"><i class="fab fa-x-twitter"></i></a>
                </div>
            </div>
            <div class="footer-legal">
                <p>¬© <span id="footerYear"></span> Conecta FCFM. Todos los derechos reservados.</p>
                <p class="legal-disclaimer">Prototipo interno: la informaci√≥n mostrada es demostrativa y puede cambiar antes del lanzamiento.</p>
            </div>
        </div>
    </footer>

    <!-- Panic Modal -->
    <!-- Trip Detail Modal -->
    <div class="modal hidden" id="tripDetailModal">
        <div class="modal-content trip-detail-modal">
            <button class="close-modal" id="closeTripDetailBtn" aria-label="Cerrar detalles">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h3 id="tripDetailTitle">Detalle del viaje</h3>
                <p id="tripDetailSubtitle" class="trip-detail-subtitle"></p>
            </div>
                <div class="modal-body">
                    <div class="trip-detail-info">
                        <p><strong>Conductor:</strong> <span id="tripDetailDriver">--</span></p>
                        <p><strong>Veh√≠culo:</strong> <span id="tripDetailVehicle">--</span></p>
                        <p><strong>Horario:</strong> <span id="tripDetailSchedule">--</span></p>
                        <p><strong>Descripci√≥n:</strong> <span id="tripDetailDescription">--</span></p>
                        <p><strong>Punto de encuentro:</strong> <span id="tripDetailMeeting">--</span></p>
                    </div>
                    <div class="map-container">
                        <div id="tripDetailMap" class="leaflet-map"></div>
                        <p class="map-placeholder">La ruta aparecer√° aqu√≠.</p>
                    </div>
                    <p class="pickup-instruction" id="pickupInstruction"></p>
                    <div class="participants-section hidden" id="tripParticipantsSection">
                        <h4>Participantes</h4>
                        <div class="participant-list" id="tripDetailParticipants"></div>
                    </div>
                </div>
                <div class="modal-actions" id="tripDetailActions">
                    <button class="btn btn--primary" id="tripDetailJoinBtn">Unirse al viaje</button>
                    <button class="btn btn--secondary" id="tripDetailCloseAction">Cerrar</button>
                </div>
        </div>
    </div>

    <div class="drawer hidden" id="panicHistoryDrawer" aria-live="polite">
        <div class="drawer__header">
            <h3>Historial de alertas</h3>
            <button class="close-modal" id="closePanicHistoryBtn" aria-label="Cerrar historial">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="drawer__content" id="panicHistoryList">
            <p class="drawer-empty">Sin registros recientes.</p>
        </div>
    </div>

    <div class="modal hidden" id="panicCountdownModal">
        <div class="modal-content panic-modal">
            <div class="modal-header">
                <h3>Bot√≥n de p√°nico</h3>
            </div>
            <div class="modal-body">
                <p class="panic-message">El bot√≥n de p√°nico se activar√° en:</p>
                <div class="panic-timer" id="panicTimer">5s</div>
                <div class="panic-action-group">
                    <button class="btn btn--danger btn--full-width" id="activateNowBtn">Activar ahora</button>
                    <button class="btn btn--secondary btn--full-width" id="cancelCountdownBtn">Cancelar alerta</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="panicActiveModal">
        <div class="modal-content panic-modal">
            <div class="modal-header">
                <h3>Bot√≥n de p√°nico</h3>
            </div>
            <div class="modal-body">
                <p class="panic-message">BOT√ìN DE P√ÅNICO ACTIVADO</p>
                <p class="panic-details">Tu ubicaci√≥n y alerta han sido enviadas a:</p>
                <ul class="panic-alert-list">
                    <li>Carabineros y Guardia Ciudadana</li>
                    <li>Tus contactos de emergencia: <span id="panicContactsList">Carolina Soto (+56 9 1234 5678), Mat√≠as P√©rez (+56 9 8765 4321)</span></li>
                    <li>Los usuarios de Conecta</li>
                </ul>
                <p class="panic-note">Mant√©n la calma y busca un lugar seguro.</p>
                <div class="panic-action-group">
                    <button class="btn btn--danger btn--full-width" id="cancelActiveBtn">Cancelar alerta</button>
                    <button class="btn btn--outline btn--full-width" id="keepBrowsingBtn">Seguir navegando</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="tripFeedbackModal">
        <div class="modal-content feedback-modal">
            <button class="close-modal" id="closeFeedbackModalBtn" aria-label="Cerrar feedback">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h3>Evaluar viaje</h3>
                <p id="feedbackModalSubtitle">Comparte c√≥mo result√≥ el trayecto para fortalecer la confianza.</p>
            </div>
            <form id="tripFeedbackForm">
                <input type="hidden" name="userTripId" id="feedbackTripId">
                <div class="form-group">
                    <label class="form-label" for="feedbackRating">Calificaci√≥n general</label>
                    <input type="range" min="1" max="5" step="1" id="feedbackRating" name="rating" value="5">
                    <div class="feedback-scale">
                        <span>Malo</span>
                        <span>Excelente</span>
                    </div>
                    <p class="feedback-rating-value"><span id="feedbackRatingValue">5</span> / 5</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="feedbackDonation">Donaci√≥n entregada (CLP)</label>
                    <input type="number" class="form-control" id="feedbackDonation" name="donation" min="0" placeholder="1500">
                </div>
                <div class="form-group">
                    <label class="form-label" for="feedbackNotes">Comentarios</label>
                    <textarea class="form-control" id="feedbackNotes" name="notes" rows="3" placeholder="¬øAlgo que debamos saber?"></textarea>
                </div>
                <button type="submit" class="btn btn--primary btn--full-width">Enviar feedback</button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>
